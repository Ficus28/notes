{% extends 'base.html' %}
{% load static %}

{% block title %}{{ note.title|default:"–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞" }}{% endblock %}

{% block extra_head %}
    {{ form.media }}
    <link rel="stylesheet" href="{% static 'css/ckeditor_custom.css' %}">

    <script>
        // –ü–µ—Ä–µ–¥–∞—ë–º CSRF —Ç–æ–∫–µ–Ω –¥–ª—è CKEditor5
        window.CKEDITOR_CSRF_TOKEN = (function () {
            const name = 'csrftoken';
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + '=')) {
                    return decodeURIComponent(cookie.substring(name.length + 1));
                }
            }
            return '';
        })();
    </script>
{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow rounded-4">
    <div class="card-body">
      <h2 class="card-title mb-4">
        {% if note %}‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å{% else %}üìù –î–æ–±–∞–≤–∏—Ç—å{% endif %} –∑–∞–º–µ—Ç–∫—É
      </h2>

      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="mb-3">
          <label for="id_title" class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
          {{ form.title }}
        </div>

        <div class="mb-3">
          <label for="id_content" class="form-label">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ</label>
          {{ form.content }}
        </div>

        <div class="mb-3">
          <label for="id_image" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          {{ form.image }}
          {% if note.image %}
            <div class="mt-2">
              <img src="{{ note.image.url }}" class="img-thumbnail" style="max-height: 200px;" alt="Preview">
            </div>
          {% endif %}
        </div>

        <button type="submit" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <a href="{% url 'home' %}" class="btn btn-secondary">‚Ü©Ô∏è –ù–∞–∑–∞–¥</a>
      </form>
    </div>
  </div>
</div>
{% endblock %}
